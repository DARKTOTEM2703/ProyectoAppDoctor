# Instrucciones para GitHub Copilot - Proyecto AppDoctor

## üè• Contexto del Proyecto

**AppDoctor** es una aplicaci√≥n m√©dica con arquitectura monorepo:

- **Frontend M√≥vil** (`/appdoctor`): Flutter + Material Design
- **Backend API** (`/back_doctor`): Laravel + Sanctum Authentication

---

## ‚ö†Ô∏è REGLAS CR√çTICAS DE RED (WSL + Scrcpy)

### Configuraci√≥n de IPs:
- **PC (Backend)**: `192.168.1.8`
- **Celular Android (App)**: `192.168.1.6` (conectado v√≠a ADB/Scrcpy)

### ‚ùå NUNCA hagas esto:
```dart
// ‚ùå INCORRECTO - No funciona en dispositivo f√≠sico
Uri.parse('http://localhost:8000/api/login')
Uri.parse('http://127.0.0.1:8000/api/login')
```

### ‚úÖ SIEMPRE haz esto:
```dart
// ‚úÖ CORRECTO - Usa Config.dart
import 'package:appdoctor/utils/config.dart';
Uri.parse('${Config.fullApiUrl}/login')
```

### Backend Laravel:
```bash
# El backend se sirve con:
php artisan serve --host 0.0.0.0 --port 8000

# Accesible desde:
# - PC: http://localhost:8000
# - Red local: http://192.168.1.8:8000
```

---

## üìÅ Estructura de Archivos Clave

```
appdoctor/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.dart          # Configuraci√≥n global (colores, dimensiones, API)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_service.dart     # Servicio HTTP centralizado
‚îÇ   ‚îú‚îÄ‚îÄ screens/                 # Pantallas de la app
‚îÇ   ‚îú‚îÄ‚îÄ widgets/                 # Widgets reutilizables
‚îÇ   ‚îî‚îÄ‚îÄ components/              # Componentes modulares

back_doctor/
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ api.php                  # Rutas de API
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Http/Controllers/        # Controladores
‚îÇ   ‚îî‚îÄ‚îÄ Models/                  # Modelos Eloquent
```

---

## üé® Convenciones de C√≥digo

### Flutter (Dart)

#### Colores y Dimensiones:
```dart
// ‚úÖ Usa Config.dart para mantener consistencia
import 'package:appdoctor/utils/config.dart';

Container(
  color: Config.colorprimario,  // Colors.greenAccent
  width: Config.obtenerAnchoDePantalla,
  height: Config.obtenerAltoDePantalla * 0.5,
)

// Espaciados predefinidos
Column(
  children: [
    Text('T√≠tulo'),
    Config.espacioPequeno,  // SizedBox(height: 25)
    Text('Subt√≠tulo'),
    Config.espacioMediano,  // 5% de la altura
    ElevatedButton(...),
  ],
)
```

#### Peticiones HTTP:
```dart
// ‚úÖ Usa ApiService para todas las peticiones
import 'package:appdoctor/services/api_service.dart';

// POST
final response = await ApiService.post('login', {
  'email': email,
  'password': password,
});

// GET con token
final userData = await ApiService.get('user', token: accessToken);
```

#### Estilo de TextField:
```dart
TextField(
  decoration: InputDecoration(
    border: Config.bordeRedondeado,
    focusedBorder: Config.bordeEnfocado,
    errorBorder: Config.bordeError,
  ),
)
```

### Laravel (PHP)

#### Rutas API (routes/api.php):
```php
// Rutas p√∫blicas
Route::post('/login', [AuthController::class, 'login']);
Route::post('/register', [AuthController::class, 'register']);

// Rutas protegidas con Sanctum
Route::middleware('auth:sanctum')->group(function () {
    Route::get('/user', [UserController::class, 'show']);
    Route::post('/appointments', [AppointmentController::class, 'store']);
});
```

#### Respuestas JSON:
```php
// ‚úÖ Formato est√°ndar de respuestas
return response()->json([
    'success' => true,
    'data' => $data,
    'message' => 'Operaci√≥n exitosa'
], 200);

// Error
return response()->json([
    'success' => false,
    'message' => 'Error en la operaci√≥n',
    'errors' => $validator->errors()
], 422);
```

---

## üîê Autenticaci√≥n (Laravel Sanctum)

### Login en Laravel:
```php
public function login(Request $request)
{
    $credentials = $request->validate([
        'email' => 'required|email',
        'password' => 'required',
    ]);

    if (!Auth::attempt($credentials)) {
        return response()->json(['message' => 'Credenciales inv√°lidas'], 401);
    }

    $user = Auth::user();
    $token = $user->createToken('auth_token')->plainTextToken;

    return response()->json([
        'access_token' => $token,
        'token_type' => 'Bearer',
        'user' => $user,
    ]);
}
```

### Uso en Flutter:
```dart
final response = await ApiService.post('login', {
  'email': 'doctor@example.com',
  'password': 'password123',
});

final token = response['access_token'];
// Guardar token en SharedPreferences o secure_storage
```

---

## üõ†Ô∏è Comandos √ötiles

### Flutter:
```bash
flutter run -d 192.168.1.6  # Correr en dispositivo conectado
flutter pub get              # Instalar dependencias
flutter clean                # Limpiar build
```

### Laravel:
```bash
php artisan serve --host 0.0.0.0  # Servidor accesible en red local
php artisan migrate                # Ejecutar migraciones
php artisan db:seed                # Poblar base de datos
php artisan route:list             # Ver todas las rutas
```

### ADB/Scrcpy:
```bash
adb devices                  # Ver dispositivos conectados
adb tcpip 5555              # Activar modo TCP
adb connect 192.168.1.6     # Conectar por WiFi
scrcpy                      # Iniciar Scrcpy
```

---

## üåê Variables de Entorno

### Flutter (opcional - crear .env):
```env
API_BASE_URL=http://192.168.1.8:8000/api
```

### Laravel (.env):
```env
APP_URL=http://192.168.1.8:8000
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=appdoctor
DB_USERNAME=root
DB_PASSWORD=

SANCTUM_STATEFUL_DOMAINS=192.168.1.8,192.168.1.6
```

---

## üìù Generaci√≥n de Modelos

### Desde Laravel a Flutter:

**Modelo Laravel (app/Models/Doctor.php):**
```php
class Doctor extends Model
{
    protected $fillable = ['name', 'specialty', 'email'];
}
```

**P√≠deme generar el modelo Dart equivalente:**
```
@workspace Genera el modelo Doctor.dart desde app/Models/Doctor.php con m√©todos fromJson y toJson
```

---

## üí° Tips de Productividad

1. **Usa `@workspace` en Copilot** para que analice todo el proyecto antes de responder
2. **Snippets personalizados** para c√≥digo repetitivo (ya configurados)
3. **Hot Reload** de Flutter para ver cambios instant√°neos
4. **Logs de Debug** habilitados en `ApiService` para troubleshooting

---

## üêõ Debugging Common Issues

### "Connection refused" desde Flutter:
- ‚úÖ Verifica que Laravel est√© corriendo: `php artisan serve --host 0.0.0.0`
- ‚úÖ Confirma la IP en `Config.dart` sea `192.168.1.8`
- ‚úÖ Revisa el firewall de Windows (permitir puerto 8000)

### "CORS error":
A√±ade en Laravel `config/cors.php`:
```php
'paths' => ['api/*'],
'allowed_origins' => ['*'],
'allowed_methods' => ['*'],
```

---

## üì± Dispositivo de Prueba

- **Modelo**: Xiaomi Redmi M2101K7BL
- **Android**: 13
- **Resoluci√≥n**: 1080x2400
- **Conexi√≥n**: WiFi (192.168.1.6)
- **M√©todo**: ADB + Scrcpy

---

## üó£Ô∏è Idioma

- **Explicaciones y comentarios**: Espa√±ol
- **C√≥digo (variables, funciones)**: Ingl√©s (convenci√≥n est√°ndar)
- **Documentaci√≥n**: Espa√±ol
